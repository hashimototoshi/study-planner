<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Planner â€“ 1ãƒ¶æœˆè¡¨ç¤ºï¼ˆå­¦ç¿’/ä¼‘æ—¥ãƒˆã‚°ãƒ«ï¼‹è²¼ä»˜/CSV/OCRï¼‰& ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆ</title>

<!-- ç”»åƒOCRç”¨ï¼ˆiPadã®ã¿ã§å®Œçµï¼‰ï¼šå¤±æ•—æ™‚ã¯è‹±èªãƒ¢ãƒ‡ãƒ«ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<style>
  :root{
    --line:#e5e7eb; --muted:#6b7280;
    --today-bg:#005A9C; --today-text:#ffffff;           /* æœ¬æ—¥ï¼šãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹ãƒ–ãƒ«ãƒ¼ */
    --row-gray-bg:#b0a89f; --row-gray-text:#000000;     /* å®Œäº†ï¼šã‚¸ãƒ£ãƒ³ã‚¬ãƒªã‚¢ãƒ³ç° */
    --header-bg:#ffffff; --header-shadow:0 6px 12px rgba(0,0,0,.06);
    --accent:#2563eb;
    --board:#0f3b3f; --board-frame:#2f4f4f; --desk:#ffffff; --room:#f7fafc;

    --bubble-gen-bg:#f4f8ff;   --bubble-gen-bd:#d6e6ff;  /* ä¸€èˆ¬: æ·¡ãƒ–ãƒ«ãƒ¼ */
    --bubble-fam-bg:#fff9ec;   --bubble-fam-bd:#ffe5ad;  /* æœ‰å:  ã‚¯ãƒªãƒ¼ãƒ  */

    --scale: 1; /* ä¸€è¦§è¡¨ç¤ºåˆ‡æ›¿ç”¨ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ1=æ¨™æº–, 0.75=è©°ã‚ï¼‰*/
  }
  *{box-sizing:border-box}
  body{margin:0;padding:14px;font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI",sans-serif;color:#111827;background:#fff}
  body.compact{--scale:0.72;} /* ä¸€è¦§è¡¨ç¤ºï¼ˆè©°ã‚ï¼‰ãƒ¢ãƒ¼ãƒ‰ */

  h1{margin:0 0 calc(12px*var(--scale));font-size:calc(18px*var(--scale))}
  .topbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:calc(8px*var(--scale))}
  .muted{color:var(--muted);font-size:calc(12px*var(--scale))}
  button,input[type="text"],input[type="file"]{
    padding:calc(10px*var(--scale)) calc(12px*var(--scale));
    border:1px solid var(--line);border-radius:12px;background:#fff;
    font-size:calc(16px*var(--scale))
  }
  button.primary{background:var(--accent);border-color:#2563eb;color:#fff}
  .tabs{display:flex;gap:8px;margin:6px 0 10px}
  .tab{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  .tab.active{background:#eef2ff;border-color:#c7d2fe}

  /* ä»Šæ—¥ãƒãƒŠãƒ¼ */
  .today-banner{
    margin:6px 0 10px;padding:8px 12px;border:1px solid var(--line);
    border-radius:10px;background:#f8fafc;font-size:calc(14px*var(--scale))
  }

  /* è¡¨ï¼ˆé€²æ—ï¼‰ */
  .tbl{
    width:100%;border:1px solid var(--line);border-radius:12px;overflow:auto;
    max-height:calc(84vh*var(--scale)); /* ã§ãã‚‹é™ã‚Š1ç”»é¢ã«åã‚ã‚‹ */
  }
  table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
  th,td{padding:calc(8px*var(--scale));border-bottom:1px solid var(--line);vertical-align:top;background:#fff}
  th{
    text-align:left;font-weight:600;font-size:calc(12px*var(--scale));color:var(--muted);
    position:sticky;top:0;z-index:3;background:var(--header-bg);
    border-bottom:2px solid var(--line);box-shadow:var(--header-shadow);backdrop-filter:saturate(1.1);
  }
  td.padL{padding-left:calc(14px*var(--scale))}
  td.small{width:calc(110px*var(--scale))}
  td.medium{width:calc(160px*var(--scale))}
  tr.today td{background:var(--today-bg)!important;color:var(--today-text)!important}
  tr.manual-gray td{background:var(--row-gray-bg)!important;color:var(--row-gray-text)!important}

  /* ç¨®åˆ¥ï¼šè¡¨ç¤ºï¼‹å°ãƒˆã‚°ãƒ« */
  .type-wrap{display:flex;align-items:center;gap:8px}
  .type-badge{font-weight:700}
  .type-toggle{
    padding:calc(4px*var(--scale)) calc(8px*var(--scale));
    border:1px solid var(--line);border-radius:10px;background:#fff;
    font-size:calc(12px*var(--scale));cursor:pointer
  }

  /* å³ä¸Š/å³ä¸‹ï¼šæœ¬æ—¥ã¸ï¼ˆå³ä¸‹ã¯ã‚¸ãƒ£ãƒ³ã‚¬ãƒªã‚¢ãƒãƒ ã‚¹ã‚¿ãƒ¼ï¼‰ */
  .fab{
    position:fixed;z-index:5;width:54px;height:54px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;border:1px solid var(--line);background:#fff;
    box-shadow:0 10px 20px rgba(0,0,0,.12);user-select:none;-webkit-user-select:none
  }
  .fab:hover{transform:translateY(-1px)} .fab:active{transform:translateY(0)}
  .fab-top-right{right:14px;top:14px} .fab-bottom-right{right:14px;bottom:14px}
  .fab span{font-size:22px;line-height:1}

  /* æ•™å®¤ãƒšãƒ¼ã‚¸ */
  .layout2{display:grid;gap:12px;grid-template-columns:minmax(0,1fr) 330px;align-items:start}
  .blackboard{border-radius:10px;border:2px solid var(--board-frame);background:var(--board);color:#e0f2f1;padding:10px 12px;font-weight:600;margin-bottom:10px}
  .room{border:1px solid var(--line);border-radius:12px;padding:14px;background:var(--room);max-height:80vh;overflow:auto}
  .desks{
    display:grid;gap:12px;
    grid-template-columns:repeat(3, minmax(0,1fr));
  }
  .desk{
    background:var(--desk);border:1px solid var(--line);border-radius:12px;padding:10px;
    min-height:110px;display:flex;flex-direction:column;justify-content:flex-end;position:relative;overflow:hidden
  }
  .desk .name{font-weight:700}
  .desk .role{font-size:12px;color:var(--muted)}

  /* æœºã®å†…å´ã«å‡ºã™å°¾ä»˜ãå¹ãå‡ºã—ï¼ˆåå‰ã«å°‘ã—é‡ãªã£ã¦OKï¼‰ */
  .bubble{
    position:absolute;left:8px;right:8px;top:8px;
    border:1px solid var(--bubble-gen-bd);background:var(--bubble-gen-bg);
    border-radius:12px;padding:8px 10px;font-size:14px;box-shadow:0 6px 12px rgba(0,0,0,.06);
    display:none;max-width:unset;white-space:pre-line
  }
  .bubble::after{
    content:"";position:absolute;left:22px;bottom:-10px;
    border-width:10px 10px 0 10px;border-style:solid;border-color:var(--bubble-gen-bd) transparent transparent transparent;
  }
  .bubble::before{
    content:"";position:absolute;left:22px;bottom:-9px;
    border-width:9px 9px 0 9px;border-style:solid;border-color:var(--bubble-gen-bg) transparent transparent transparent;
  }
  .bubble.famous{background:var(--bubble-fam-bg);border-color:var(--bubble-fam-bd)}
  .bubble.famous::after{border-top-color:var(--bubble-fam-bd)}
  .bubble.famous::before{border-top-color:var(--bubble-fam-bg)}
  .bubble.show{display:block;animation:fadeIn .15s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}

  /* é †ä½ã‚«ãƒ¼ãƒ‰ï¼ˆæ•™å®¤ã®å³å´ï¼‰ */
  .card{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
  .card h3{margin:0 0 8px;font-size:15px}
  .lb-row{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px dashed var(--line)}
  .lb-row:last-child{border-bottom:none}
  .me{background:#eef2ff;border-radius:8px}
  .rank{width:26px;text-align:center;font-weight:700}
  .pts{font-variant-numeric:tabular-nums}
  .chip{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;color:#374151}
</style>
</head>
<body>
  <h1>å­¦ç¿’è¨ˆç”»ï¼ˆ1ãƒ¶æœˆè¡¨ç¤ºï¼‰</h1>

  <!-- è¡¨ç¤ºåï¼ˆé †ä½ã‚„å‘¼ã³ã‹ã‘ã«ä½¿ç”¨ï¼‰ -->
  <div class="topbar">
    <input id="displayName" type="text" placeholder="è¡¨ç¤ºåï¼ˆä¾‹ï¼šã¨ã—ï¼‰" style="min-width:200px">
    <button id="saveName">ä¿å­˜</button>
    <span class="muted">â€»ä¿å­˜ã™ã‚‹ã¨å‘¼ã³ã‹ã‘ãƒ»é †ä½ã«åæ˜ </span>
  </div>

  <!-- ãƒšãƒ¼ã‚¸ã‚¿ãƒ– -->
  <div class="tabs">
    <button id="tabProgress" class="tab active">é€²æ—</button>
    <button id="tabClass" class="tab">C</button>
  </div>

  <!-- ===== Page 1: é€²æ— ===== -->
  <section id="pageProgress" style="display:block">
    <div class="topbar">
      <button id="prev" class="primary">â—€ å‰æœˆ</button>
      <div id="label" class="muted"></div>
      <button id="next" class="primary">æ¬¡æœˆ â–¶</button>
      <button id="todayBtn">âŸ³ ä»Šæ—¥ã¸</button>
      <button id="save">ğŸ’¾ æ›´æ–°/ä¿å­˜</button>
      <button id="load">ğŸ“¥ èª­è¾¼</button>
      <button id="toggleCompact">ğŸ—‚ ä¸€è¦§è¡¨ç¤º</button>
    </div>

    <!-- å–ã‚Šè¾¼ã¿ï¼ˆè²¼ä»˜ / CSV/TSV / ç”»åƒOCRï¼‰ -->
    <div class="topbar">
      <button id="importPaste">ğŸ“‹ è²¼ã‚Šä»˜ã‘å–è¾¼</button>
      <label>
        <input id="importFile" type="file" accept=".csv,.tsv,.txt" style="display:none">
        <button onclick="document.getElementById('importFile').click()">ğŸ“„ CSV/TSV/TXTå–è¾¼</button>
      </label>
      <label>
        <input id="importImg" type="file" accept="image/*" style="display:none">
        <button onclick="document.getElementById('importImg').click()">ğŸ–¼ ç”»åƒOCRå–è¾¼</button>
      </label>
      <span class="muted">â€»å½¢å¼ä¾‹ï¼š<code>8/13 ä¼‘æ—¥</code>ã€<code>8æœˆ14æ—¥ å­¦ç¿’</code>ã€ã‚¹ãƒ—ãƒ¬ã‚·ã®2åˆ—ã‚³ãƒ”ãƒ¼ç­‰</span>
    </div>

    <div id="todayBanner" class="today-banner">æœ¬æ—¥: èª­ã¿è¾¼ã¿ä¸­â€¦</div>

    <div class="tbl" id="scroller">
      <table>
        <thead>
          <tr>
            <th class="medium">æ—¥ä»˜</th>
            <th class="small padL">ç¨®åˆ¥</th>
            <th class="medium padL">ç›®æ¨™ï¼ˆç§‘ç›®åï¼‰</th>
            <th class="medium padL">çµæœ</th>
            <th class="medium padL">å¾©ç¿’</th>
            <th class="small padL">è‰²</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- å³ä¸Š/å³ä¸‹ï¼šæœ¬æ—¥ã¸ï¼ˆå³ä¸‹ã¯ğŸ¹ï¼‰ -->
    <button class="fab fab-top-right" id="fabTop" title="ä»Šæ—¥ã¸"><span>ğŸ“</span></button>
    <button class="fab fab-bottom-right" id="fabBottom" title="ä»Šæ—¥ã¸"><span>ğŸ¹</span></button>
  </section>

  <!-- ===== Page 2: ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆ ===== -->
  <section id="pageClass" style="display:none">
    <div class="blackboard">1å¹´Bçµ„ â€“ ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆãŒã€Œã¨ã—ãã‚“ã€ã‚’å…¨åŠ›å¿œæ´ï¼</div>
    <div class="layout2">
      <div class="room">
        <div class="desks" id="desks"></div>
      </div>
      <aside class="card">
        <h3>ä»Šæœˆã®é †ä½ï¼ˆåˆè¨ˆãƒã‚¤ãƒ³ãƒˆï¼‰</h3>
        <div id="leaderboard"></div>
        <div style="margin-top:8px" class="muted">
          ãƒ«ãƒ¼ãƒ«ï¼š<span class="chip">å®Œäº†=+10</span>ã€<span class="chip">å¾©ç¿’+å®Œäº†=+6</span>ã€ä¼‘æ—¥=0ã€‚<br>
          ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã¯æ—¥æ›¿ã‚ã‚Šã§è‡ªå‹•ã‚¹ã‚³ã‚¢ï¼ˆãƒãƒ¼ãƒˆãªã—ï¼‰ã€‚
        </div>
      </aside>
    </div>
  </section>

<script>
(function(){
  'use strict';
  const KEY='studyplanner.v13.ocr';
  const NAME_KEY='studyplanner.displayName';

  let year=(new Date()).getFullYear(), month=(new Date()).getMonth();
  let rows=[]; // {date,type,goal,result,review,color}

  const $=sel=>document.querySelector(sel);
  const ymd=d=>d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
  const fromYmd=s=>{const [y,m,d]=s.split('-').map(Number); return new Date(y, m-1, d);};
  const jpWeek=d=>'æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ'[d.getDay()];
  const jpDateLabel=s=>{const d=fromYmd(s);return `${d.getMonth()+1}æœˆ${d.getDate()}æ—¥(${jpWeek(d)})`;};
  function monthDates(y,m){const first=new Date(y,m,1), last=new Date(y,m+1,0), arr=[]; for(let d=new Date(first); d<=last; d.setDate(d.getDate()+1)) arr.push(ymd(d)); return arr;}

  function ensureScaffold(){
    const need=new Set(monthDates(year,month));
    const have=new Set(rows.map(r=>r.date));
    need.forEach(d=>{ if(!have.has(d)) rows.push({date:d, type:'å­¦ç¿’', goal:'', result:'', review:'', color:'normal'}); });
    rows.sort((a,b)=>a.date.localeCompare(b.date));
  }
  function persist(rec){const i=rows.findIndex(x=>x.date===rec.date); if(i>=0) rows[i]=rec; else rows.push(rec);}

  /* ===== ä¿å­˜/èª­è¾¼ï¼ˆç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ ===== */
  function save(){
    const key=`${KEY}:${year}-${String(month+1).padStart(2,'0')}`;
    const data=rows.filter(r=>fromYmd(r.date).getMonth()===month && fromYmd(r.date).getFullYear()===year);
    localStorage.setItem(key, JSON.stringify(data));
    // æ›´æ–°å¾Œã¯è‡ªå‹•ã§ä¸€è¦§ï¼ˆè©°ã‚ï¼‰è¡¨ç¤ºã«åˆ‡æ›¿
    document.body.classList.add('compact');
    alert('æ›´æ–°ã—ã¾ã—ãŸï¼ˆã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼‰');
    renderLeaderboard();
  }
  function load(){
    const key=`${KEY}:${year}-${String(month+1).padStart(2,'0')}`;
    const raw=localStorage.getItem(key);
    if(!raw) return false;
    try{
      const data=JSON.parse(raw)||[];
      const map=new Map(rows.map(r=>[r.date,r]));
      data.forEach(d=>map.set(d.date,d));
      rows=[...map.values()];
      return true;
    }catch(e){ return false; }
  }

  /* ====== é€²æ—ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå­¦ç¿’/ä¼‘æ—¥ãƒˆã‚°ãƒ« & ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆè¡¨ç¤ºï¼‰ ====== */
  function renderProgress(){
    ensureScaffold();
    $('#label').textContent=`${year}å¹´${month+1}æœˆï¼ˆ${monthDates(year,month).length}æ—¥ï¼‰`;
    const tb=$('#tbody'); tb.innerHTML='';
    const todayStr=ymd(new Date());

    monthDates(year,month).forEach(date=>{
      const r=rows.find(x=>x.date===date) || {date,type:'å­¦ç¿’',goal:'',result:'',review:'',color:'normal'};
      const tr=document.createElement('tr');

      if(r.color==='gray') tr.classList.add('manual-gray');
      else if(date===todayStr) tr.classList.add('today');

      // æ—¥ä»˜
      const tdDate=document.createElement('td'); tdDate.className='medium'; tdDate.textContent=jpDateLabel(date);

      // ç¨®åˆ¥ï¼ˆå›ºå®šè¡¨ç¤ºï¼‹å°ãƒˆã‚°ãƒ«ï¼‰
      const tdType=document.createElement('td'); tdType.className='small padL';
      const wrap=document.createElement('div'); wrap.className='type-wrap';
      const badge=document.createElement('span'); badge.className='type-badge'; badge.textContent=(r.type==='ä¼‘æ—¥')?'ä¼‘æ—¥':'å­¦ç¿’';
      const btn=document.createElement('button'); btn.className='type-toggle'; btn.type='button';
      btn.textContent=(r.type==='ä¼‘æ—¥')?'å­¦ç¿’ã«ã™ã‚‹':'ä¼‘æ—¥ã«ã™ã‚‹';
      btn.addEventListener('click',()=>{ r.type=(r.type==='ä¼‘æ—¥')?'å­¦ç¿’':'ä¼‘æ—¥'; persist(r); renderProgress(); });
      wrap.appendChild(badge); wrap.appendChild(btn); tdType.appendChild(wrap);

      // ç›®æ¨™
      const tdGoal=document.createElement('td'); tdGoal.className='medium padL';
      const inGoal=document.createElement('input'); inGoal.type='text'; inGoal.placeholder='ä¾‹ï¼šä¸–ç•Œå² 23ã€œ24';
      inGoal.value=r.goal||''; inGoal.addEventListener('input',e=>{ r.goal=e.target.value; persist(r); });
      tdGoal.appendChild(inGoal);

      // çµæœ
      const tdRes=document.createElement('td'); tdRes.className='medium padL';
      const inRes=document.createElement('input'); inRes.type='text'; inRes.placeholder='å®Ÿç¸¾';
      inRes.value=r.result||''; inRes.addEventListener('input',e=>{ r.result=e.target.value; persist(r); });
      tdRes.appendChild(inRes);

      // å¾©ç¿’
      const tdRev=document.createElement('td'); tdRev.className='medium padL';
      const inRev=document.createElement('input'); inRev.type='text'; inRev.placeholder='å¾©ç¿’ç¯„å›²';
      inRev.value=r.review||''; inRev.addEventListener('input',e=>{ r.review=e.target.value; persist(r); });
      tdRev.appendChild(inRev);

      // è‰²ï¼ˆé€šå¸¸/å®Œäº†ï¼‰
      const tdClr=document.createElement('td'); tdClr.className='small padL';
      const selClr=document.createElement('select');
      [{v:'normal',t:'é€šå¸¸'}, {v:'gray',t:'å®Œäº†'}].forEach(p=>{
        const o=document.createElement('option'); o.value=p.v; o.textContent=p.t;
        if((r.color||'normal')===p.v) o.selected=true;
        selClr.appendChild(o);
      });
      selClr.addEventListener('change',e=>{ r.color=e.target.value; persist(r); renderProgress(); renderLeaderboard(); });
      tdClr.appendChild(selClr);

      tr.appendChild(tdDate); tr.appendChild(tdType); tr.appendChild(tdGoal);
      tr.appendChild(tdRes); tr.appendChild(tdRev); tr.appendChild(tdClr);
      tb.appendChild(tr);
    });

    const t=new Date();
    $('#todayBanner').textContent=`æœ¬æ—¥: ${t.getMonth()+1}æœˆ${t.getDate()}æ—¥(${jpWeek(t)})`;
  }

  function scrollTodayIntoView(){
    const scroller=$('#scroller'); const thead=scroller.querySelector('thead');
    const todayRow=scroller.querySelector('tr.today')||scroller.querySelector('tbody tr'); if(!todayRow) return;
    const headerH=thead.getBoundingClientRect().height; const rowTop=todayRow.offsetTop;
    scroller.scrollTo({top:Math.max(0,rowTop-headerH-4),behavior:'smooth'});
  }

  /* ====== å–ã‚Šè¾¼ã¿ï¼šè²¼ä»˜ / CSV/TSV / OCRï¼ˆç”»åƒï¼‰ ====== */
  function parseTypeImport(text){
    // è¡Œã”ã¨ã« 8/13 ä¼‘æ—¥ / 8æœˆ13æ—¥ å­¦ç¿’ / 8/13(æ°´),ä¼‘æ—¥ ãªã©ã‚’æ¤œå‡º
    const lines = (text||'').replace(/\r/g,'').split('\n').map(s=>s.trim()).filter(Boolean);
    const pairs=[];
    const mNow=month+1, yNow=year;
    const re = /(?:(\d{1,2})[\/\-æœˆ](\d{1,2})æ—¥?)(?:\([^)]*\))?[\s,ã€€]*([^\s,ã€€]+)/; // mm/dd or mæœˆdæ—¥ + ç¨®åˆ¥
    for(const ln of lines){
      const m = ln.match(re);
      if(m){
        let mth=parseInt(m[1],10), day=parseInt(m[2],10);
        let typ=(m[3]||'').replace(/\s/g,'').trim();
        if(!/^(å­¦ç¿’|ä¼‘æ—¥|å¾©ç¿’)$/u.test(typ)) continue;
        // æœˆãŒçœç•¥/ç•°ãªã‚‹å ´åˆã§ã‚‚ã€å½“æœˆã®åŒæ—¥ã¸åæ˜ ï¼ˆmth != mNow ã§ã‚‚ day ã¯æ¡ç”¨ï¼‰
        pairs.push({day, type:typ});
        continue;
      }
      // åˆ—ãŒã‚¿ãƒ–/ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼š 8/13\tä¼‘æ—¥
      const cols=ln.split(/[\t,ï¼Œ ]+/).map(s=>s.trim()).filter(Boolean);
      if(cols.length>=2){
        const d2=cols[0], t2=cols[1];
        const m2 = d2.match(/(\d{1,2})[\/\-æœˆ](\d{1,2})/);
        if(m2 && /^(å­¦ç¿’|ä¼‘æ—¥|å¾©ç¿’)$/u.test(t2)){
          pairs.push({day:parseInt(m2[2],10), type:t2});
        }
      }
    }
    // åæ˜ 
    let applied=0;
    for(const {day,type} of pairs){
      const dateStr=ymd(new Date(year, month, day));
      const r=rows.find(x=>x.date===dateStr);
      if(r){ r.type=type; persist(r); applied++; }
    }
    return applied;
  }

  async function ocrImage(file){
    try{
      const worker = await Tesseract.createWorker('jpn');
      const { data:{ text } } = await worker.recognize(file);
      await worker.terminate();
      return text;
    }catch(e){
      // æ—¥æœ¬èªãƒ¢ãƒ‡ãƒ«ãŒå–ã‚Œãªã„ç­‰ â†’ è‹±èªã§ãƒªãƒˆãƒ©ã‚¤
      try{
        const worker = await Tesseract.createWorker('eng');
        const { data:{ text } } = await worker.recognize(file);
        await worker.terminate();
        return text;
      }catch(err){
        throw e;
      }
    }
  }

  /* ====== ãƒ©ãƒ³ã‚­ãƒ³ã‚° ====== */
  function myMonthlyPoints(){
    let total=0;
    monthDates(year,month).forEach(date=>{
      const r=rows.find(x=>x.date===date); if(!r) return;
      if(r.color==='gray'){ // å®Œäº†
        if(r.type==='å¾©ç¿’') total+=6;
        else if(r.type==='å­¦ç¿’') total+=10;
      }
    });
    return total;
  }
  function seedRand(seed){let x=seed%2147483647; if(x<=0)x+=2147483646; return ()=> (x=x*16807%2147483647)/2147483647;}
  function classmatesMonthlyPoints(){
    const seed=parseInt(`${year}${String(month+1).padStart(2,'0')}`);
    const rnd=seedRand(seed); const dates=monthDates(year,month);
    return CLASSMATES.filter(n=>n!=='ï¼ˆã‚ãªãŸï¼‰').map(name=>{
      let sum=0; dates.forEach(()=>{const r=rnd(); if(r>0.65) sum+=10; else if(r>0.50) sum+=6;});
      return {name, pts:sum};
    });
  }
  function renderLeaderboard(){
    const meName=(($('#displayName').value)||'ã‚ãªãŸ').trim();
    const mePts=myMonthlyPoints();
    const rivals=classmatesMonthlyPoints();
    const list=[...rivals,{name:meName,pts:mePts,me:true}].sort((a,b)=>b.pts-a.pts);
    const box=$('#leaderboard'); if(!box) return;
    box.innerHTML='';
    list.forEach((p,i)=>{
      const div=document.createElement('div'); div.className='lb-row'+(p.me?' me':'');
      div.innerHTML=`<div style="display:flex;gap:8px;align-items:center">
        <span class="rank">${i+1}</span><strong>${p.name}</strong></div>
        <div class="pts">${p.pts} pt</div>`;
      box.appendChild(div);
    });
  }

  /* ====== ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆï¼ˆå¤§é‡è¿½åŠ ï¼†ã‚ˆã‚Šãƒ©ãƒ³ãƒ€ãƒ ï¼‰ ====== */
  const CLASSMATES = [
    'ï¼ˆã‚ãªãŸï¼‰',
    // æ—¢å­˜
    'ã„ã‹','æ°¸ç”°ç§€ä»','é«˜æ©‹','å¶‹åº·','ç”°ä¸­','æ± ä¹‹å†…è‹±æ˜','åŠ è—¤','å”æ‰å…ˆç”Ÿ','æˆæœ¨æ´‹å¹³','ä½ã€…æœ¨','å¯Œç”°é›„äºŒ','å¯Œå³¶é›…äºº',
    'ã·ã‚ãŸã‚“','å¤§æ£®å…ƒæœ¨','æ©‹æœ¬ç¯„ä¹‹','ç±³å±±éš†ä¸€','ã²ã‚ã‚†ã',
    // è¿½åŠ ï¼ˆæœ‰åäººå¤šæ•°ï¼‰
    'æœ›æœˆäºœå¸Œå­','ç¶¾ç€¬ã¯ã‚‹ã‹','å‰ç€¬ç¾æ™ºå­','æ°¸é‡èŠ½éƒ','çŸ³åŸã•ã¨ã¿','åŒ—å·æ™¯å­','æœ‰æ‘æ¶ç´”','é•·æ¾¤ã¾ã•ã¿','åºƒç€¬ã™ãš','æ·±ç”°æ­å­',
    'å‰å²¡ç¾ç©‚','æœ¬ç”°ç¿¼','æ©‹æœ¬æ´‹å­','æ','æœ¨æ‘æ–‡ä¹ƒ','å„ªé¦™','ç”Ÿç”°çµµæ¢¨èŠ±','ä¸Šæˆ¸å½©','èœã€…ç·’','å†…ç”°æœ‰ç´€','è’äº•ã•ã‚“',
    'å¤šéƒ¨æœªè¯å­','æˆ¸ç”°æµæ¢¨é¦™','åºƒç€¬ã‚¢ãƒªã‚¹','å‰é«˜ç”±é‡Œå­'
  ];
  const FAMOUS_SET = new Set([
    'ã·ã‚ãŸã‚“','å¤§æ£®å…ƒæœ¨','ç±³å±±éš†ä¸€','ã²ã‚ã‚†ã',
    'ç¶¾ç€¬ã¯ã‚‹ã‹','å‰ç€¬ç¾æ™ºå­','æ°¸é‡èŠ½éƒ','çŸ³åŸã•ã¨ã¿','åŒ—å·æ™¯å­','æœ‰æ‘æ¶ç´”','é•·æ¾¤ã¾ã•ã¿','åºƒç€¬ã™ãš','æ·±ç”°æ­å­',
    'å‰å²¡ç¾ç©‚','æœ¬ç”°ç¿¼','æ','æœ¨æ‘æ–‡ä¹ƒ','å„ªé¦™','ç”Ÿç”°çµµæ¢¨èŠ±','ä¸Šæˆ¸å½©','èœã€…ç·’','å†…ç”°æœ‰ç´€','å¤šéƒ¨æœªè¯å­','æˆ¸ç”°æµæ¢¨é¦™','åºƒç€¬ã‚¢ãƒªã‚¹','å‰é«˜ç”±é‡Œå­'
  ]);

  // ã‚­ãƒ£ãƒ©åˆ¥ã®â€œã‚‰ã—ã„â€é›°å›²æ°—ã®åŠ±ã¾ã—ï¼ˆå‰µä½œï¼‰ã€‚åŒæ–‡å›é¿ã®ãŸã‚ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¤šã‚ã€‚
  const LINES = {
    'ï¼ˆã‚ãªãŸï¼‰': [
      'ã¨ã—ãã‚“ã€è‡ªåˆ†ã§è‡ªåˆ†ã‚’å¾ŒæŠ¼ã—ã€‚ã¾ãš1è¡Œã€æ‰‹ã‚’å‹•ã‹ãã†ã€‚',
      'ã€Œå§‹ã‚ã‚‹ã€ã¯æœ€é«˜ã®æ‰èƒ½ã€‚ä»Šã®1åˆ†ãŒæœªæ¥ã‚’å¤‰ãˆã‚‹ã‚ˆã€‚'
    ],
    'ã·ã‚ãŸã‚“': [
      'æœ€åˆã®1ãƒ¬ãƒƒãƒ—ãŒä¸€ç•ªé‡ã„ã€‚1ãƒšãƒ¼ã‚¸ã‚„ã‚Œã°ä½“æ¸©ä¸ŠãŒã‚‹ï¼',
      'å°ã•ã„ç©ã¿ä¸Šã’ãŒä¸€ç•ªå¼·ã„ã€‚ä»Šæ—¥ã®â€œå®Œäº†â€ã§è‡ªä¿¡ã¤ã‘ã‚ˆã†ï¼',
      'ã‚„ã‚‰ãªã„å¾Œæ‚”ã‚ˆã‚Šã€ã‚„ã£ãŸç–²åŠ´ã€‚çµ‚ã‚ã£ãŸã‚‰ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã„ã“ã†ï¼'
    ],
    'å¤§æ£®å…ƒæœ¨': [
      'æƒ…ç†±ã¯è¡Œå‹•ã§ç‚¹ç«ã™ã‚‹ã€‚ã¾ãšã¯æ‰‹ã‚’ä¼¸ã°ã›ï¼',
      'è¿·ã„ã¯ç‡ƒæ–™ã€‚ãƒšãƒ¼ã‚¸ã‚’é–‹ã‘ã°ç«ã¯ã¤ãï¼',
      'å‹è² ã©ã“ã‚ã¯â€œä»Šâ€ã€‚1ãƒ†ãƒ¼ãƒã§æµã‚Œã‚’å¤‰ãˆã‚ˆã†ï¼'
    ],
    'ç±³å±±éš†ä¸€': [
      'å¾®å°ãªåŠªåŠ›ã®ç·å’ŒãŒæˆæœã€‚5åˆ†ã®å¾®åˆ†ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€‚',
      'é¸æŠã®ã‚³ã‚¹ãƒˆã¯å°ã•ãã€ç¶™ç¶šã®ä¾¡å€¤ã¯å¤§ãã„ã€‚ä»Šã€ç€æ‰‹ã‚’ã€‚',
      'ãƒ‡ãƒ¼ã‚¿ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€‚å­¦ç¿’æ™‚é–“ã¯å¿…ãšåæŸã™ã‚‹ã‚ˆã€‚'
    ],
    'ã²ã‚ã‚†ã': [
      'ã‚„ã‚‰ãªã„ã¨ã‚¼ãƒ­ã€‚ã‚„ã‚Œã°1ã€‚ã‚¼ãƒ­ã¨1ã®å·®ã¯å¤§ãã„ã§ã™ã‚ˆã€‚',
      'ã¾ãš5åˆ†ã‚„ã£ã¦ã¿ã‚Œã°ï¼Ÿ æ„å¤–ã¨ç¶šãã‚“ã§ã€‚',
      'è¨€ã„è¨³ã®ã‚³ã‚¹ãƒ‘ã€æ‚ªã„ã£ã™ã€‚ã‚„ã‚‹äººãŒçµå±€å‹ã¤ã€‚'
    ],
    // æˆæœ¨ï¼ˆå¼·æ°—ï¼‰ / æ°¸ç”°ï¼ˆã‚„ã•ã—ã„ï¼‰
    'æˆæœ¨æ´‹å¹³': [
      'ã¨ã—ãã‚“ã€æ”»ã‚ã‚‹ã€‚1ãƒšãƒ¼ã‚¸ã§æµã‚Œã‚’æ´ã‚ï¼',
      'å¼·æ°—ã§ã„ã“ã†ã€‚ä»Šã®ä¸€æ­©ãŒå‹¢ã„ã‚’ä½œã‚‹ï¼',
      'è¿·ã†å‰ã«å‹•ã‘ã€‚ã‚„ã‚Œã°åˆ†ã‹ã‚‹ã€ã™ãã«ã€‚'
    ],
    'æ°¸ç”°ç§€ä»': [
      'å¤§ä¸ˆå¤«ã€ã‚†ã£ãã‚Šã§ã„ã„ã€‚1ã¤ã§ãã‚Œã°ååˆ†ã ã‚ˆã€‚',
      'ç„¦ã‚‰ãªãã¦ã„ã„ã‚ˆã€‚å°ã•ãªé€²æ­©ã‚’ä¸€ç·’ã«ç©ã‚‚ã†ã€‚',
      'ä¼‘ã¿ãŸã„æ—¥ã¯åŠæ­©ã ã‘ã€‚å„ªã—ãç¶šã‘ã‚ˆã†ã€‚'
    ],
    // å…ˆç”Ÿï¼ˆæ—¥æœ¬å²é¢¨ï¼‰
    'å”æ‰å…ˆç”Ÿ': [
      'ã€Œç‚ºã›ã°æˆã‚‹ã€â€”â€”ä¸Šæ‰é·¹å±±ã®æ°—æŒã¡ã§ã„ã“ã†ã€‚',
      'å‚æœ¬é¾é¦¬ã‚‚æœ€åˆã®ä¸€æ­©ã‹ã‚‰ã€‚ã•ã‚ã€å‹•ã“ã†ã€‚',
      'è¥¿éƒ·ã©ã‚“ã®èƒ†åŠ›ã§ã€‚ã¾ãšã¯â€œã‚„ã£ã¦ã¿ã‚‹â€ã˜ã‚ƒã€‚'
    ]
  };

  // æœ‰åäººï¼ˆå¥³å„ªãªã©ï¼‰ã¯æŸ”ã‚‰ã‹/å‰å‘ããƒ»å‡›ã¨ã—ãŸç³»ã‚’ä¸­å¿ƒã«å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç”Ÿæˆ
  const FEMALE_FAMOUS_GENERIC = [
    'ç©ã¿é‡ã­ãŒä¸€ç•ªã®å‘³æ–¹ã ã‚ˆã€‚ã„ã¾ã®1ãƒšãƒ¼ã‚¸ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€ã¨ã—ãã‚“ã€‚',
    'æ·±å‘¼å¸ã—ã¦ã€ãƒšãƒ¼ã‚¸ã‚’ã²ã‚‰ãã€‚ãã‚Œã§ååˆ†ã€æµã‚Œã¯æ¥ã‚‹ã‚ˆã€‚',
    'å®Œç’§ã§ãªãã¦ã„ã„ã€‚ç¶šã‘ãŸäººãŒã€çµå±€ã„ã¡ã°ã‚“å¼·ã„ã€‚'
  ];

  // ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼ï¼šå¿ƒã«æ®‹ã‚‹çŸ­ã„åŠ±ã¾ã—ï¼ˆé‡è¤‡å›é¿ç”¨ã«ååˆ†ãªæ•°ï¼‰
  const GENERAL_QUOTES = [
    'åƒé‡Œã®é“ã‚‚ä¸€æ­©ã‹ã‚‰ã€‚ã¾ãš5åˆ†ã‚„ã£ã¦ã¿ã‚ˆã†ã€‚',
    'æ˜¨æ—¥ã‚ˆã‚Šä»Šæ—¥ã€ä»Šæ—¥ã‚ˆã‚Šæ˜æ—¥ã€‚å°ã•ãªå‰é€²ã‚’ç©ã‚‚ã†ã€‚',
    'æ‰‹ã‚’å‹•ã‹ã›ã°é›†ä¸­ã¯è‚²ã¤ã€‚å§‹ã‚ãŸã‚‰å‹ã¡ã€‚',
    'ã§ãã‚‹ã“ã¨ã‹ã‚‰ä¸€ã¤ãšã¤ã€‚ç©ã¿ä¸Šã’ã¯è£åˆ‡ã‚‰ãªã„ã€‚',
    'å®Œç’§ã‚ˆã‚Šç¶™ç¶šã€‚ä»Šæ—¥ã¯â€œå®Œäº†â€ã«å¤‰ãˆã‚ˆã†ã€‚',
    'è¿·ã£ãŸã‚‰é–‹ãã€‚ãƒšãƒ¼ã‚¸ã‚’é–‹ã‘ã°ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‹ã‚‹ã€‚',
    'æŒ‘æˆ¦ã—ãªã‘ã‚Œã°ä½•ã‚‚å§‹ã¾ã‚‰ãªã„ã€‚å°ã•ãæŒ‘ã‚‚ã†ã€‚',
    'You can do it! ã¾ãš1å•ã€æ‰‹ã‚’ã¤ã‘ã‚ˆã†ã€‚',
    'æ­¢ã¾ã£ã¦ã‚‚OKã€ã¾ãŸæ­©ãå‡ºã›ã°ã„ã„ã€‚',
    'ä»Šã®ä¸€æ­©ãŒã€æœªæ¥ã®è‡ªåˆ†ã‚’åŠ©ã‘ã‚‹ã‚ˆã€‚'
  ];

  // äººâ†’å‰å›ã‚»ãƒªãƒ•è¨˜éŒ²ã§â€œåŒã˜ç™ºè¨€é€£ç¶šâ€ã‚’é¿ã‘ã‚‹
  const lastLineByName = new Map();
  function pickLine(name){
    let arr;
    if(LINES[name]) arr = LINES[name];
    else if(FAMOUS_SET.has(name)) arr = FEMALE_FAMOUS_GENERIC;
    else arr = GENERAL_QUOTES;
    if(!arr || arr.length===0) arr = ['ã¨ã—ãã‚“ã€ä»Šã ã€‚å°ã•ãå§‹ã‚ã‚ˆã†ã€‚'];

    // ç›´å‰ã¨åŒã˜ã¯é¿ã‘ã‚‹
    let line = arr[Math.floor(Math.random()*arr.length)];
    const last = lastLineByName.get(name);
    if(arr.length>1 && line===last){
      // åˆ¥ã®ã‚’ã‚‚ã†ä¸€åº¦å¼•ã
      line = arr[(Math.floor(Math.random()* (arr.length-1)) + 1) % arr.length];
    }
    lastLineByName.set(name, line);
    // â€œã¨ã—ãã‚“â€å‘¼ã³ã‚’è£œå¼·
    if(!/^ã¨ã—ãã‚“/.test(line)) line = 'ã¨ã—ãã‚“ã€' + line;
    return line;
  }

  function buildClassroom(){
    const meName=(($('#displayName').value)||'ã‚ãªãŸ').trim();
    const desks=$('#desks'); desks.innerHTML='';

    CLASSMATES.forEach((name, idx)=>{
      const d=document.createElement('div'); d.className='desk';
      const bubbleId=`bubble-${idx}`;
      const isYou = (name==='ï¼ˆã‚ãªãŸï¼‰');
      d.innerHTML = `
        <div class="bubble ${FAMOUS_SET.has(name)?'famous':''}" id="${bubbleId}"></div>
        <div class="name">${isYou ? meName : name}</div>
        <div class="role">${isYou ? 'ï¼ˆã‚ãªãŸï¼‰' : 'ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆ'}</div>`;
      desks.appendChild(d);
    });

    // ã—ã‚ƒã¹ã‚‹ï¼ˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ï¼šé–“éš”ã‚‚å†…å®¹ã‚‚ç‹¬ç«‹ï¼‰
    const allBubbles = CLASSMATES.map((_,i)=>document.getElementById(`bubble-${i}`)).filter(Boolean);
    function speak(i){
      const who = CLASSMATES[i];
      const b = allBubbles[i]; if(!b) return;
      const isFamous = FAMOUS_SET.has(who);
      b.classList.toggle('famous', isFamous);
      b.textContent = pickLine(who);
      b.classList.add('show');

      // è¡¨ç¤ºæ™‚é–“ï¼šæœ‰å=5ç§’ã€ä¸€èˆ¬=8ç§’
      const showMs = isFamous ? 5000 : 8000;
      setTimeout(()=>b.classList.remove('show'), showMs);

      // æ¬¡ç™ºè©±ï¼š4ã€œ9ç§’ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆé‡ãªã‚Š/åŒæ™‚ç™ºè©±ã‚’æ•£ã‚‰ã™ï¼‰
      const nextMs = 4000 + Math.floor(Math.random()*5000);
      setTimeout(()=>speak(i), nextMs);
    }
    allBubbles.forEach((_,i)=>{
      setTimeout(()=>speak(i), Math.floor(Math.random()*1200));
    });

    renderLeaderboard();
  }

  /* ====== ã‚¿ãƒ–åˆ‡æ›¿ ====== */
  function showPage(which){
    const p1=$('#pageProgress'), p2=$('#pageClass');
    const t1=$('#tabProgress'), t2=$('#tabClass');
    const is1=(which==='progress');
    p1.style.display=is1?'block':'none';
    p2.style.display=is1?'none':'block';
    t1.classList.toggle('active', is1);
    t2.classList.toggle('active', !is1);
    if(is1){
      renderProgress();
      setTimeout(scrollTodayIntoView, 60);
    }else{
      buildClassroom();
    }
  }

  /* ====== ã‚¤ãƒ™ãƒ³ãƒˆ ====== */
  // åå‰
  (function initName(){
    const saved=localStorage.getItem(NAME_KEY);
    if(saved) $('#displayName').value=saved;
  })();
  $('#saveName').addEventListener('click',()=>{ localStorage.setItem(NAME_KEY, ($('#displayName').value||'ã‚ãªãŸ').trim()); renderLeaderboard(); });

  // ã‚¿ãƒ–
  $('#tabProgress').addEventListener('click',()=>showPage('progress'));
  $('#tabClass').addEventListener('click',()=>showPage('class'));

  // é€²æ—æ“ä½œ
  $('#prev').addEventListener('click',()=>{ month-=1; if(month<0){month=11;year-=1;} load(); renderProgress(); setTimeout(scrollTodayIntoView,40); });
  $('#next').addEventListener('click',()=>{ month+=1; if(month>11){month=0;year+=1;} load(); renderProgress(); setTimeout(scrollTodayIntoView,40); });
  $('#save').addEventListener('click',save);
  $('#load').addEventListener('click',()=>{ const ok=load(); renderProgress(); setTimeout(scrollTodayIntoView,40); alert(ok?'èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆç«¯æœ«å†…ãƒ‡ãƒ¼ã‚¿ï¼‰':'ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); });
  $('#todayBtn').addEventListener('click',scrollTodayIntoView);
  $('#toggleCompact').addEventListener('click',()=>{ document.body.classList.toggle('compact'); });

  // å–ã‚Šè¾¼ã¿ï¼šè²¼ä»˜
  $('#importPaste').addEventListener('click',()=>{
    const text = prompt('æ—¥ä»˜ã¨ç¨®åˆ¥ã®ä¸€è¦§ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆä¾‹: 8/13 ä¼‘æ—¥ï¼‰');
    if(!text) return;
    const n = parseTypeImport(text);
    renderProgress();
    alert(n?`å½“æœˆã« ${n} ä»¶åæ˜ ã—ã¾ã—ãŸ`:'åæ˜ å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
  });

  // å–ã‚Šè¾¼ã¿ï¼šCSV/TSV/TXT
  $('#importFile').addEventListener('change',async (e)=>{
    const f=e.target.files?.[0]; if(!f) return;
    const txt=await f.text();
    const n=parseTypeImport(txt);
    renderProgress();
    alert(n?`å½“æœˆã« ${n} ä»¶åæ˜ ã—ã¾ã—ãŸ`:'åæ˜ å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
    e.target.value='';
  });

  // å–ã‚Šè¾¼ã¿ï¼šç”»åƒOCR
  $('#importImg').addEventListener('change',async (e)=>{
    const f=e.target.files?.[0]; if(!f) return;
    try{
      const text = await ocrImage(f);
      const n = parseTypeImport(text||'');
      renderProgress();
      alert(n?`OCRã§èª­ã¿å–ã‚Šã€å½“æœˆã« ${n} ä»¶åæ˜ ã—ã¾ã—ãŸ`:'æ–‡å­—ãŒèªè­˜ã§ããªã„ã‹ã€åæ˜ å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
    }catch(err){
      alert('OCRã«å¤±æ•—ã—ã¾ã—ãŸã€‚ç”»åƒãŒé®®æ˜ã‹ã€ç…§æ˜ã‚„å‚¾ãã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }finally{
      e.target.value='';
    }
  });

  // åˆæœŸè¡¨ç¤ºï¼é€²æ—ã€ã‹ã¤ä¸€è¦§ï¼ˆè©°ã‚ï¼‰ã‚’æ—¢å®šONã«
  load(); renderProgress(); document.body.classList.add('compact');
  window.addEventListener('load', ()=> setTimeout(scrollTodayIntoView,80));
})();
</script>
</body>
</html>
