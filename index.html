<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Study Planner â€“ é€²æ— & ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆï¼ˆ1å¹´Bçµ„ï¼‰</title>
<style>
  :root{
    --line:#e5e7eb; --muted:#6b7280;
    --today-bg:#005A9C;      /* æœ¬æ—¥ï¼šãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹ãƒ–ãƒ«ãƒ¼ */
    --today-text:#ffffff;
    --row-gray-bg:#b0a89f;   /* å®Œäº†ï¼šã‚¸ãƒ£ãƒ³ã‚¬ãƒªã‚¢ãƒ³ç° */
    --row-gray-text:#000000;
    --header-bg:#ffffff; --header-shadow:0 6px 12px rgba(0,0,0,.06);
    --accent:#2563eb;
    --board:#0f3b3f; --board-frame:#2f4f4f;
    --desk:#ffffff; --room:#f7fafc;
  }
  *{box-sizing:border-box}
  body{
    margin:0;padding:14px;
    font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI",sans-serif;
    color:#111827;background:#fff
  }
  h1{margin:0 0 12px;font-size:18px}
  .topbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
  .muted{color:var(--muted);font-size:12px}
  button,input[type="text"]{
    padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font-size:16px
  }
  button.primary{background:var(--accent);border-color:#2563eb;color:#fff}
  .tabs{display:flex;gap:8px;margin:6px 0 10px}
  .tab{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  .tab.active{background:#eef2ff;border-color:#c7d2fe}

  /* ä»Šæ—¥ãƒãƒŠãƒ¼ */
  .today-banner{
    margin:6px 0 10px;padding:8px 12px;border:1px solid var(--line);
    border-radius:10px;background:#f8fafc;font-size:14px
  }

  /* è¡¨ï¼ˆé€²æ—ï¼‰ */
  .tbl{
    width:100%;border:1px solid var(--line);border-radius:12px;overflow:auto;max-height:82vh;
  }
  table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
  th,td{padding:12px;border-bottom:1px solid var(--line);vertical-align:top;background:#fff}
  th{
    text-align:left;font-weight:600;font-size:12px;color:var(--muted);
    position:sticky;top:0;z-index:3;background:var(--header-bg);
    border-bottom:2px solid var(--line);box-shadow:var(--header-shadow);backdrop-filter:saturate(1.1);
  }
  td.padL{padding-left:22px}
  td.small{width:120px}
  td.medium{width:180px}
  tr.today td{background:var(--today-bg)!important;color:var(--today-text)!important}
  tr.manual-gray td{background:var(--row-gray-bg)!important;color:var(--row-gray-text)!important}

  /* å³ä¸Š/å³ä¸‹ï¼šæœ¬æ—¥ã¸ */
  .fab{
    position:fixed;z-index:5;width:54px;height:54px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;border:1px solid var(--line);background:#fff;
    box-shadow:0 10px 20px rgba(0,0,0,.12);user-select:none;-webkit-user-select:none
  }
  .fab:hover{transform:translateY(-1px)} .fab:active{transform:translateY(0)}
  .fab-top-right{right:14px;top:14px} .fab-bottom-right{right:14px;bottom:14px}
  .fab span{font-size:22px;line-height:1}

  /* æ•™å®¤ãƒšãƒ¼ã‚¸ */
  .layout2{
    display:grid;gap:12px;grid-template-columns:minmax(0,1fr) 330px;align-items:start;
  }
  .blackboard{
    border-radius:10px;border:2px solid var(--board-frame);background:var(--board);color:#e0f2f1;
    padding:10px 12px;font-weight:600;margin-bottom:10px
  }
  .room{border:1px solid var(--line);border-radius:12px;padding:14px;background:var(--room)}
  .desks{display:grid;gap:12px;grid-template-columns:repeat(3, minmax(0,1fr))}
  .desk{
    background:var(--desk);border:1px solid var(--line);border-radius:12px;padding:10px;
    min-height:92px;display:flex;flex-direction:column;justify-content:space-between;position:relative
  }
  .desk .name{font-weight:700}
  .desk .role{font-size:12px;color:var(--muted)}
  .bubble{
    position:absolute;left:8px;top:-6px;transform:translateY(-100%);
    background:#fff;border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-size:14px;box-shadow:0 6px 12px rgba(0,0,0,.06);
    display:none;max-width:260px;white-space:pre-line
  }
  .bubble.show{display:block;animation:fadeIn .15s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(-110%)}to{opacity:1;transform:translateY(-100%)}}

  /* é †ä½ã‚«ãƒ¼ãƒ‰ï¼ˆæ•™å®¤ã®å³å´ï¼‰ */
  .card{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
  .card h3{margin:0 0 8px;font-size:15px}
  .lb-row{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px dashed var(--line)}
  .lb-row:last-child{border-bottom:none}
  .me{background:#eef2ff;border-radius:8px}
  .rank{width:26px;text-align:center;font-weight:700}
  .pts{font-variant-numeric:tabular-nums}
  .chip{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;color:#374151}
</style>
</head>
<body>
  <h1>å­¦ç¿’è¨ˆç”»ï¼ˆ1ãƒ¶æœˆè¡¨ç¤ºï¼‰</h1>

  <!-- è¡¨ç¤ºåï¼ˆé †ä½ã‚„å‘¼ã³ã‹ã‘ã«ä½¿ç”¨ï¼‰ -->
  <div class="topbar">
    <input id="displayName" type="text" placeholder="è¡¨ç¤ºåï¼ˆä¾‹ï¼šã¨ã—ï¼‰" style="min-width:200px">
    <button id="saveName">ä¿å­˜</button>
    <span class="muted">â€»ä¿å­˜ã™ã‚‹ã¨å‘¼ã³ã‹ã‘ãƒ»é †ä½ã«åæ˜ ã•ã‚Œã¾ã™</span>
  </div>

  <!-- ãƒšãƒ¼ã‚¸ã‚¿ãƒ– -->
  <div class="tabs">
    <button id="tabProgress" class="tab active">é€²æ—</button>
    <button id="tabClass" class="tab">ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆ</button>
  </div>

  <!-- ===== Page 1: é€²æ— ===== -->
  <section id="pageProgress" style="display:block">
    <div class="topbar">
      <button id="prev" class="primary">â—€ å‰æœˆ</button>
      <div id="label" class="muted"></div>
      <button id="next" class="primary">æ¬¡æœˆ â–¶</button>
      <button id="todayBtn">âŸ³ ä»Šæ—¥ã¸</button>
      <button id="save">ğŸ’¾ ä¿å­˜</button>
      <button id="load">ğŸ“¥ èª­è¾¼</button>
    </div>
    <div id="todayBanner" class="today-banner">æœ¬æ—¥: èª­ã¿è¾¼ã¿ä¸­â€¦</div>

    <div class="tbl" id="scroller">
      <table>
        <thead>
          <tr>
            <th class="medium">æ—¥ä»˜</th>
            <th class="small padL">ç¨®åˆ¥</th>
            <th class="medium padL">ç›®æ¨™ï¼ˆç§‘ç›®åï¼‰</th>
            <th class="medium padL">çµæœ</th>
            <th class="medium padL">å¾©ç¿’</th>
            <th class="small padL">è‰²</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- å³ä¸Š/å³ä¸‹ï¼šæœ¬æ—¥ã¸ -->
    <button class="fab fab-top-right" id="fabTop" title="ä»Šæ—¥ã¸"><span>ğŸ¦¾</span></button>
    <button class="fab fab-bottom-right" id="fabBottom" title="ä»Šæ—¥ã¸"><span>âš¾ï¸</span></button>
  </section>

  <!-- ===== Page 2: ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆï¼ˆ1å¹´Bçµ„ï¼‰ ===== -->
  <section id="pageClass" style="display:none">
    <div class="blackboard">1å¹´Bçµ„ â€“ ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆãŒã€Œã¨ã—ãã‚“ã€ã‚’å…¨åŠ›å¿œæ´ï¼</div>
    <div class="layout2">
      <div class="room">
        <div class="desks" id="desks"></div>
      </div>
      <aside class="card">
        <h3>ä»Šæœˆã®é †ä½ï¼ˆåˆè¨ˆãƒã‚¤ãƒ³ãƒˆï¼‰</h3>
        <div id="leaderboard"></div>
        <div style="margin-top:8px" class="muted">
          ãƒ«ãƒ¼ãƒ«ï¼š<span class="chip">å®Œäº†=+10</span>ã€<span class="chip">å¾©ç¿’+å®Œäº†=+6</span>ã€ä¼‘æ—¥=0ã€‚<br>
          ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆã¯æ—¥æ›¿ã‚ã‚Šã§è‡ªå‹•ã‚¹ã‚³ã‚¢ï¼ˆãƒãƒ¼ãƒˆãªã—ï¼‰ã€‚
        </div>
      </aside>
    </div>
  </section>

  <script>
  (function(){
    'use strict';
    const KEY='studyplanner.month.form.v8.fixedtype';
    const NAME_KEY='studyplanner.displayName';

    // æœˆãƒ»ãƒ‡ãƒ¼ã‚¿
    let year=(new Date()).getFullYear(), month=(new Date()).getMonth();
    let rows=[]; // {date,type,goal,result,review,color}

    const $=sel=>document.querySelector(sel);
    const ymd=d=>d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
    const fromYmd=s=>{const [y,m,d]=s.split('-').map(Number); return new Date(y, m-1, d);};
    const jpWeek=d=>'æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ'[d.getDay()];
    const jpDateLabel=s=>{const d=fromYmd(s);return `${d.getMonth()+1}æœˆ${d.getDate()}æ—¥(${jpWeek(d)})`;};
    function monthDates(y,m){const first=new Date(y,m,1), last=new Date(y,m+1,0), arr=[]; for(let d=new Date(first); d<=last; d.setDate(d.getDate()+1)) arr.push(ymd(d)); return arr;}

    function ensureScaffold(){
      const need=new Set(monthDates(year,month));
      const have=new Set(rows.map(r=>r.date));
      need.forEach(d=>{ if(!have.has(d)) rows.push({date:d, type:'å­¦ç¿’', goal:'', result:'', review:'', color:'normal'}); });
      rows.sort((a,b)=>a.date.localeCompare(b.date));
    }
    function persist(rec){const i=rows.findIndex(x=>x.date===rec.date); if(i>=0) rows[i]=rec; else rows.push(rec);}

    // ä¿å­˜/èª­è¾¼ï¼ˆç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
    function save(){
      try{
        const key=`${KEY}:${year}-${String(month+1).padStart(2,'0')}`;
        const data=rows.filter(r=>fromYmd(r.date).getMonth()===month && fromYmd(r.date).getFullYear()===year);
        localStorage.setItem(key, JSON.stringify(data));
        alert('ä¿å­˜ã—ã¾ã—ãŸï¼ˆã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼‰');
        renderLeaderboard();
      }catch(e){}
    }
    function load(){
      const key=`${KEY}:${year}-${String(month+1).padStart(2,'0')}`;
      const raw=localStorage.getItem(key);
      if(!raw) return false;
      try{
        const data=JSON.parse(raw)||[];
        const map=new Map(rows.map(r=>[r.date,r]));
        data.forEach(d=>map.set(d.date,d));
        rows=[...map.values()];
        return true;
      }catch(e){ return false; }
    }

    /* ========= é€²æ—ãƒšãƒ¼ã‚¸ï¼ˆç¨®åˆ¥ã¯å›ºå®šè¡¨ç¤ºï¼‰ ========= */
    function renderProgress(){
      ensureScaffold();
      $('#label').textContent=`${year}å¹´${month+1}æœˆï¼ˆ${monthDates(year,month).length}æ—¥ï¼‰`;

      const tb=$('#tbody'); tb.innerHTML='';
      const todayStr=ymd(new Date());

      monthDates(year,month).forEach(date=>{
        const r=rows.find(x=>x.date===date) || {date,type:'å­¦ç¿’',goal:'',result:'',review:'',color:'normal'};
        const tr=document.createElement('tr');

        if(r.color==='gray') tr.classList.add('manual-gray');
        else if(date===todayStr) tr.classList.add('today');

        // æ—¥ä»˜
        const tdDate=document.createElement('td');
        tdDate.className='medium';
        tdDate.textContent=jpDateLabel(date);

        // ç¨®åˆ¥ï¼ˆå›ºå®šè¡¨ç¤ºã®ã¿ï¼‰
        const tdType=document.createElement('td'); tdType.className='small padL';
        const badge=document.createElement('span');
        badge.style.fontWeight='600';
        badge.textContent=(r.type==='ä¼‘æ—¥')?'ä¼‘æ—¥':'å­¦ç¿’';
        tdType.appendChild(badge);

        // ç›®æ¨™ï¼ˆç·¨é›†å¯ï¼‰
        const tdGoal=document.createElement('td'); tdGoal.className='medium padL';
        const inGoal=document.createElement('input'); inGoal.type='text'; inGoal.placeholder='ä¾‹ï¼šä¸–ç•Œå² 23ã€œ24';
        inGoal.value=r.goal||'';
        inGoal.addEventListener('input',e=>{ r.goal=e.target.value; persist(r); });
        tdGoal.appendChild(inGoal);

        // çµæœï¼ˆç·¨é›†å¯ï¼‰
        const tdRes=document.createElement('td'); tdRes.className='medium padL';
        const inRes=document.createElement('input'); inRes.type='text'; inRes.placeholder='å®Ÿç¸¾';
        inRes.value=r.result||'';
        inRes.addEventListener('input',e=>{ r.result=e.target.value; persist(r); });
        tdRes.appendChild(inRes);

        // å¾©ç¿’ï¼ˆç·¨é›†å¯ï¼‰
        const tdRev=document.createElement('td'); tdRev.className='medium padL';
        const inRev=document.createElement('input'); inRev.type='text'; inRev.placeholder='å¾©ç¿’ç¯„å›²';
        inRev.value=r.review||'';
        inRev.addEventListener('input',e=>{ r.review=e.target.value; persist(r); });
        tdRev.appendChild(inRev);

        // è‰²ï¼ˆé€šå¸¸/å®Œäº†ï¼‰
        const tdClr=document.createElement('td'); tdClr.className='small padL';
        const selClr=document.createElement('select');
        [{v:'normal',t:'é€šå¸¸'}, {v:'gray',t:'å®Œäº†'}].forEach(p=>{
          const o=document.createElement('option'); o.value=p.v; o.textContent=p.t;
          if((r.color||'normal')===p.v) o.selected=true;
          selClr.appendChild(o);
        });
        selClr.addEventListener('change',e=>{ r.color=e.target.value; persist(r); renderProgress(); renderLeaderboard(); });
        tdClr.appendChild(selClr);

        tr.appendChild(tdDate); tr.appendChild(tdType); tr.appendChild(tdGoal);
        tr.appendChild(tdRes); tr.appendChild(tdRev); tr.appendChild(tdClr);
        tb.appendChild(tr);
      });

      const t=new Date();
      $('#todayBanner').textContent=`æœ¬æ—¥: ${t.getMonth()+1}æœˆ${t.getDate()}æ—¥(${jpWeek(t)})`;
    }

    function scrollTodayIntoView(){
      const scroller=$('#scroller'); const thead=scroller.querySelector('thead');
      const todayRow=scroller.querySelector('tr.today')||scroller.querySelector('tbody tr'); if(!todayRow) return;
      const headerH=thead.getBoundingClientRect().height; const rowTop=todayRow.offsetTop;
      scroller.scrollTo({top:Math.max(0,rowTop-headerH-4),behavior:'smooth'});
    }

    /* ========= é †ä½è¨ˆç®— ========= */
    function myMonthlyPoints(){
      let total=0;
      monthDates(year,month).forEach(date=>{
        const r=rows.find(x=>x.date===date); if(!r) return;
        if(r.color==='gray'){ // å®Œäº†
          if(r.type==='å¾©ç¿’') total+=6;
          else if(r.type==='å­¦ç¿’') total+=10;
        }
      });
      return total;
    }
    function seedRand(seed){let x=seed%2147483647; if(x<=0)x+=2147483646; return ()=> (x=x*16807%2147483647)/2147483647;}
    function classmatesMonthlyPoints(){
      const seed=parseInt(`${year}${String(month+1).padStart(2,'0')}`);
      const rnd=seedRand(seed); const dates=monthDates(year,month);
      return CLASSMATES.filter(n=>n!=='ï¼ˆã‚ãªãŸï¼‰').map(name=>{
        let sum=0;
        dates.forEach(()=>{const r=rnd(); if(r>0.65) sum+=10; else if(r>0.50) sum+=6;});
        return {name, pts:sum};
      });
    }
    function renderLeaderboard(){
      const meName=(($('#displayName').value)||'ã‚ãªãŸ').trim();
      const mePts=myMonthlyPoints();
      const rivals=classmatesMonthlyPoints();
      const list=[...rivals,{name:meName,pts:mePts,me:true}].sort((a,b)=>b.pts-a.pts);
      const box=$('#leaderboard'); if(!box) return;
      box.innerHTML='';
      list.forEach((p,i)=>{
        const div=document.createElement('div'); div.className='lb-row'+(p.me?' me':'');
        div.innerHTML=`<div style="display:flex;gap:8px;align-items:center">
          <span class="rank">${i+1}</span><strong>${p.name}</strong></div>
          <div class="pts">${p.pts} pt</div>`;
        box.appendChild(div);
      });
    }

    /* ========= ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆï¼ˆæ•™å®¤ï¼‰ ========= */
    const CLASSMATES = [
      'ã„ã‹','æ°¸ç”°ç§€ä»','é«˜æ©‹','å¶‹åº·','ç”°ä¸­','æ± ä¹‹å†…è‹±æ˜','åŠ è—¤','å”æ‰å…ˆç”Ÿ',
      'æˆæœ¨æ´‹å¹³','ä½ã€…æœ¨','å¯Œç”°é›„äºŒ','å¯Œå³¶é›…äºº','ã·ã‚ãŸã‚“','å¤§æ£®å…ƒæœ¨','æ©‹æœ¬ç¯„ä¹‹','ç±³å±±éš†ä¸€','ã²ã‚ã‚†ã'
    ];

    // ã‚»ãƒªãƒ•ç¾¤
    const GENERAL_QUOTES = [
      'åƒé‡Œã®é“ã‚‚ä¸€æ­©ã‹ã‚‰ã€‚ã¾ãš5åˆ†ã‚„ã£ã¦ã¿ã‚ˆã†ã€ã¨ã—ãã‚“ã€‚',
      'æ˜¨æ—¥ã‚ˆã‚Šä»Šæ—¥ã€ä»Šæ—¥ã‚ˆã‚Šæ˜æ—¥ã€‚å°ã•ãªå‰é€²ã‚’ç©ã¿é‡ã­ã‚ˆã†ã€ã¨ã—ãã‚“ã€‚',
      'æ‰‹ã‚’å‹•ã‹ã™ã»ã©ã€é›†ä¸­ã¯è‚²ã¤ã€‚å§‹ã‚ã‚Œã°å‹ã¡ã€ã¨ã—ãã‚“ã€‚',
      'ã§ãã‚‹ã“ã¨ã‹ã‚‰ä¸€ã¤ãšã¤ã€‚ç©ã¿ä¸Šã’ã¯è£åˆ‡ã‚‰ãªã„ã‚ˆã€ã¨ã—ãã‚“ã€‚',
      'å®Œç’§ã‚ˆã‚Šç¶™ç¶šã€‚ä»Šæ—¥ã¯â€œå®Œäº†â€ã«å¤‰ãˆã‚‹ã¨ã“ã‚ã¾ã§è¡Œã“ã†ã€ã¨ã—ãã‚“ã€‚',
      'å¿ƒãŒã–ã‚ã¤ã„ãŸã‚‰æ·±å‘¼å¸ã€‚ãƒšãƒ¼ã‚¸ã‚’ã‚ãã£ãŸã‚‰ã€ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‹ã‚‹ã‚ˆã€ã¨ã—ãã‚“ã€‚',
      'æŒ‘æˆ¦ã—ãªã„ã¨ä½•ã‚‚å§‹ã¾ã‚‰ãªã„ã€‚å°ã•ãæŒ‘ã‚‚ã†ã€ã¨ã—ãã‚“ã€‚',
      'You can do it, Toshikun! ã¾ãš1å•ã€æ‰‹ã‚’ã¤ã‘ã‚ˆã†ã€‚'
    ];
    const FAMOUS_LINES = {
      'ã·ã‚ãŸã‚“': [
        'ã¨ã—ãã‚“ã€ç­‹ãƒˆãƒ¬ã¨åŒã˜ã€‚æœ€åˆã®1ãƒ¬ãƒƒãƒ—ãŒä¸€ç•ªé‡ã„ã€‚1ãƒšãƒ¼ã‚¸ã‚„ã‚Œã°ä½“æ¸©ä¸ŠãŒã‚‹ï¼',
        'å°ã•ã„ç©ã¿ä¸Šã’ãŒä¸€ç•ªå¼·ã„ã€‚ä»Šæ—¥ã®â€œå®Œäº†â€ã§è‡ªä¿¡ã¤ã‘ã‚ˆã†ï¼',
        'ã‚„ã‚‰ãªã„å¾Œæ‚”ã‚ˆã‚Šã€ã‚„ã£ãŸç–²åŠ´ã€‚çµ‚ã‚ã£ãŸã‚‰ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã„ã“ã†ï¼'
      ],
      'å¤§æ£®å…ƒæœ¨': [
        'æƒ…ç†±ã¯è¡Œå‹•ã§ç‚¹ç«ã™ã‚‹ã€‚ã¨ã—ãã‚“ã€ã¾ãšã¯æ‰‹ã‚’ä¼¸ã°ã›ï¼',
        'è¿·ã†æ™‚é–“ã¯ç‡ƒæ–™ã«ãªã‚‹ã€‚ãƒšãƒ¼ã‚¸ã‚’é–‹ã‘ã°ã€ç«ã¯ã¤ãï¼',
        'å‹è² ã©ã“ã‚ã¯â€œä»Šâ€ã€‚1ãƒ†ãƒ¼ãƒã§æµã‚Œã‚’å¤‰ãˆã‚ˆã†ï¼'
      ],
      'ç±³å±±éš†ä¸€': [
        'ç©åˆ†ã®ã‚ˆã†ã«ã€å¾®å°ãªåŠªåŠ›ã®ç·å’ŒãŒæˆæœã ã‚ˆã€‚ã¨ã—ãã‚“ã€å¾®åˆ†1ã¤ã‹ã‚‰ã€‚',
        'é¸æŠã®ã‚³ã‚¹ãƒˆã¯å°ã•ãã€ç¶™ç¶šã®ä¾¡å€¤ã¯å¤§ãã„ã€‚5åˆ†ã®æ±ºæ–­ã‚’ã€‚', 
        'ãƒ‡ãƒ¼ã‚¿ã¯å˜˜ã‚’ã¤ã‹ãªã„ã€‚å­¦ç¿’æ™‚é–“ã¯ç¢ºå®Ÿã«çµæœã¸åæŸã™ã‚‹ã‚ˆã€‚'
      ],
      'ã²ã‚ã‚†ã': [
        'ã‚„ã‚‹äººã¯çµå±€å‹ã¤ã‚“ã§ã™ã‚ˆã€‚ã‚„ã‚‰ãªã„è¨€ã„è¨³ã€ã‚³ã‚¹ãƒ‘æ‚ªã„ã£ã™ã€‚',
        'ã¾ãš5åˆ†ã‚„ã£ã¦ã¿ã‚Œã°ï¼Ÿ æ„å¤–ã¨ç¶šãã‚“ã§ã€‚', 
        'ã‚„ã‚‰ãªã„ã¨ã‚¼ãƒ­ã€‚ã‚„ã‚Œã°1ã€‚ã‚¼ãƒ­ã¨1ã®å·®ã£ã¦ã€ã‚ã¡ã‚ƒãã¡ã‚ƒå¤§ãã„ã§ã™ã‚ˆã€‚'
      ]
    };

    function buildClassroom(){
      const meName=(($('#displayName').value)||'ã‚ãªãŸ').trim();
      const desks=$('#desks'); desks.innerHTML='';
      // ä¸¦ã³ï¼šã‚ãªãŸ + æŒ‡å®š17åï¼åˆè¨ˆ18å¸­ï¼ˆ6Ã—3ã§ã‚‚OKï¼‰ã€‚ã“ã“ã§ã¯ 3åˆ—ã‚°ãƒªãƒƒãƒ‰ã«é †ç•ªé…ç½®ã€‚
      const names=['ï¼ˆã‚ãªãŸï¼‰', ...CLASSMATES];
      names.forEach((name, idx)=>{
        const d=document.createElement('div'); d.className='desk';
        const bubbleId=`bubble-${idx}`;
        d.innerHTML = `
          <div class="bubble" id="${bubbleId}"></div>
          <div class="name">${name==='ï¼ˆã‚ãªãŸï¼‰' ? meName : name}</div>
          <div class="role">${name==='ï¼ˆã‚ãªãŸï¼‰' ? 'ï¼ˆã‚ãªãŸï¼‰' : 'ã‚¯ãƒ©ã‚¹ãƒ¡ã‚¤ãƒˆ'}</div>`;
        desks.appendChild(d);
      });

      // è¡¨ç¤ºç›´å¾Œã«å…¨å“¡ã—ã‚ƒã¹ã‚‹â†’ä»¥å¾Œãƒ©ãƒ³ãƒ€ãƒ é–“éš”ã§æ›´æ–°
      const allBubbles = names.map((_,i)=>document.getElementById(`bubble-${i}`)).filter(Boolean);
      function sayFor(i){
        const b = allBubbles[i]; if(!b) return;
        const speaker = names[i];
        let text = '';
        if (speaker==='ï¼ˆã‚ãªãŸï¼‰') {
          text = `ã¨ã—ãã‚“ã€è‡ªåˆ†ã§è‡ªåˆ†ã‚’åŠ±ã¾ã›ã‚‹æ—¥ã‚‚ã‚ã‚‹ã€‚\nã¾ãšã¯1è¡Œã€æ›¸ã„ã¦ã¿ã‚ˆã†ã€‚`;
        } else if (FAMOUS_LINES[speaker]) {
          const arr = FAMOUS_LINES[speaker];
          text = arr[Math.floor(Math.random()*arr.length)];
        } else {
          const arr = GENERAL_QUOTES;
          text = arr[Math.floor(Math.random()*arr.length)];
        }
        b.textContent = text;
        b.classList.add('show');
        // è¡¨ç¤ºæ™‚é–“ï¼šæœ‰åäººä»¥å¤–ã¯8ç§’ã€ æœ‰åäººã¯5ç§’
        const isFamous = Boolean(FAMOUS_LINES[speaker]);
        const showMs = isFamous ? 5000 : 8000;
        setTimeout(()=>b.classList.remove('show'), showMs);

        // æ¬¡å›ã¾ã§ã®å¾…æ©Ÿï¼š5ã€œ8ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ 
        const nextMs = 5000 + Math.floor(Math.random()*3000);
        setTimeout(()=>sayFor(i), nextMs);
      }
      // åˆå›èµ·å‹•ï¼ˆå…¨å“¡ï¼‰
      allBubbles.forEach((_,i)=>{
        // åˆå›ã¯0ã€œ1000msã®ãƒ©ãƒ³ãƒ€ãƒ é…å»¶ã§ã‚¹ã‚¿ãƒ¼ãƒˆ
        setTimeout(()=>sayFor(i), Math.floor(Math.random()*1000));
      });
    }

    /* ========= ã‚¿ãƒ–åˆ‡æ›¿ ========= */
    function showPage(which){
      const p1=$('#pageProgress'), p2=$('#pageClass');
      const t1=$('#tabProgress'), t2=$('#tabClass');
      const is1=(which==='progress');
      p1.style.display=is1?'block':'none';
      p2.style.display=is1?'none':'block';
      t1.classList.toggle('active', is1);
      t2.classList.toggle('active', !is1);
      if(is1){
        renderProgress();
        setTimeout(scrollTodayIntoView, 80);
      }else{
        buildClassroom();
        renderLeaderboard();
      }
    }

    /* ========= ã‚¤ãƒ™ãƒ³ãƒˆ ========= */
    // åå‰
    (function initName(){
      const saved=localStorage.getItem(NAME_KEY);
      if(saved) $('#displayName').value=saved;
    })();
    $('#saveName').addEventListener('click',()=>{ localStorage.setItem(NAME_KEY, ($('#displayName').value||'ã‚ãªãŸ').trim()); renderLeaderboard(); });

    // ã‚¿ãƒ–
    $('#tabProgress').addEventListener('click',()=>showPage('progress'));
    $('#tabClass').addEventListener('click',()=>showPage('class'));

    // é€²æ—ãƒšãƒ¼ã‚¸æ“ä½œ
    $('#prev').addEventListener('click',()=>{ month-=1; if(month<0){month=11;year-=1;} load(); renderProgress(); setTimeout(scrollTodayIntoView,50); });
    $('#next').addEventListener('click',()=>{ month+=1; if(month>11){month=0;year+=1;} load(); renderProgress(); setTimeout(scrollTodayIntoView,50); });
    $('#save').addEventListener('click',save);
    $('#load').addEventListener('click',()=>{ const ok=load(); renderProgress(); setTimeout(scrollTodayIntoView,50); alert(ok?'èª­ã¿è¾¼ã¿ã¾ã—ãŸ':'ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); });
    $('#todayBtn').addEventListener('click',scrollTodayIntoView);
    // å³ä¸Š/å³ä¸‹ãƒœã‚¿ãƒ³ï¼ˆæœ¬æ—¥ã¸ï¼‰ã¯çœç•¥ï¼ˆå¿…è¦ãªã‚‰å¾©æ´»å¯ï¼‰

    // åˆæœŸè¡¨ç¤ºï¼é€²æ—
    load(); renderProgress();
    window.addEventListener('load', ()=> setTimeout(scrollTodayIntoView,80));
  })();
  </script>
</body>
</html>
